Srno,src_file_name,exp_columns,is_active,stg_schema_name,stg_table_name,raw_schema_name,raw_table_name,curated_schema_name,curated_table_name,stg_query,raw_to_curated_qry
5,dim_reseller.csv,"ResellerKey,ResellerID,BusinessType,Reseller,City,StateProvince,CountryRegion,PostalCode,LastModifiedOn",true,ds_stg,dim_reseller,ds_raw,dim_reseller,ds_curated,dim_reseller,,"MERGE ds_curated.dim_reseller T USING (select * from (select *, row_number() over(partition by ResellerKey order by LastModifiedOn desc) as ROW_NUM   from ds_raw.dim_reseller WHERE src_file_name ='{0}') t where t.ROW_NUM = 1) S ON T.ResellerKey = S.ResellerKey WHEN MATCHED THEN UPDATE SET T.ResellerKey=S.ResellerKey,T.ResellerID=S.ResellerID,T.BusinessType=S.BusinessType,T.Reseller=S.Reseller,T.City=S.City,T.StateProvince=S.StateProvince,T.CountryRegion=S.CountryRegion,T.PostalCode=S.PostalCode,T.Ingestion_Date=current_timestamp(), T.src_file_name=S.src_file_name, T.LastModifiedOn=S.LastModifiedOn WHEN NOT MATCHED THEN INSERT (ResellerKey,ResellerID,BusinessType,Reseller,City,StateProvince,CountryRegion,PostalCode,Ingestion_Date,src_file_name,LastModifiedOn) VALUES(S.ResellerKey,S.ResellerID,S.BusinessType,S.Reseller,S.City,S.StateProvince,S.CountryRegion,S.PostalCode,current_timestamp(),  src_file_name,  LastModifiedOn)"
7,dim_territory.csv,"TerritoryKey,Region,Country,CountryGroup,LastModifiedOn",true,ds_stg,dim_territory,ds_raw,dim_territory,ds_curated,dim_territory,,"MERGE ds_curated.dim_territory T USING (select * from (select *, row_number() over(partition by TerritoryKey order by LastModifiedOn desc) as ROW_NUM   from ds_raw.dim_territory WHERE src_file_name ='{0}') t where t.ROW_NUM = 1) S ON T.TerritoryKey = S.TerritoryKey WHEN MATCHED THEN UPDATE SET T.TerritoryKey=S.TerritoryKey,T.Region=S.Region,T.Country=S.Country,T.CountryGroup=S.CountryGroup,T.Ingestion_Date=current_timestamp(), T.src_file_name=S.src_file_name, T.LastModifiedOn=S.LastModifiedOn WHEN NOT MATCHED THEN INSERT (Region,TerritoryKey,Country,CountryGroup,Ingestion_Date,src_file_name,LastModifiedOn) VALUES(S.Region,S.TerritoryKey,S.Country,S.CountryGroup,current_timestamp(),  src_file_name,  LastModifiedOn)"
4,dim_product.csv,"ProductKey,SKU,Product,StandardCost,Color,ListPrice,Model,SubCategory,Category,LastModifiedOn",true,ds_stg,dim_product,ds_raw,dim_product,ds_curated,dim_product,,"MERGE ds_curated.dim_product T USING (select * from (select *, row_number() over(partition by ProductKey order by LastModifiedOn desc) as ROW_NUM   from ds_raw.dim_product WHERE src_file_name ='{0}') t where t.ROW_NUM = 1) S ON T.ProductKey = S.ProductKey WHEN MATCHED THEN UPDATE SET T.ProductKey=S.ProductKey,T.SKU=S.SKU,T.Product=S.Product,T.StandardCost=S.StandardCost,T.Color=S.Color,T.ListPrice=S.ListPrice,T.Model=S.Model,T.SubCategory=S.SubCategory,T.Category=S.Category,T.Ingestion_Date=current_timestamp(), T.src_file_name=S.src_file_name, T.LastModifiedOn=S.LastModifiedOn WHEN NOT MATCHED THEN INSERT (ProductKey,SKU,Product,StandardCost,Color,ListPrice,Model,SubCategory,Category,Ingestion_Date,src_file_name,LastModifiedOn) VALUES(S.ProductKey,S.SKU,S.Product,S.StandardCost,S.Color,S.ListPrice,S.Model,S.SubCategory,S.Category,current_timestamp(),  src_file_name,  LastModifiedOn)"
2,dim_date.csv,"DateKey,Date,FiscalYear,FiscalQuarter,Month,FullDate,MonthKey,LastModifiedOn",true,ds_stg,dim_date,ds_raw,dim_date,ds_curated,dim_date,,"MERGE ds_curated.dim_date T USING (select * from (select *, row_number() over(partition by DateKey order by LastModifiedOn desc) as ROW_NUM   from ds_raw.dim_date WHERE src_file_name ='{0}') t where t.ROW_NUM = 1) S ON T.DateKey = S.DateKey WHEN MATCHED THEN UPDATE SET T.DateKey=S.DateKey,T.Date=S.Date,T.FiscalYear=S.FiscalYear,T.FiscalQuarter=S.FiscalQuarter,T.Month=S.Month,T.FullDate=S.FullDate,T.MonthKey=S.MonthKey,T.Ingestion_Date=current_timestamp(), T.src_file_name=S.src_file_name, T.LastModifiedOn=S.LastModifiedOn WHEN NOT MATCHED THEN INSERT (DateKey,Date,FiscalYear,FiscalQuarter,Month,FullDate,MonthKey,Ingestion_Date,src_file_name,LastModifiedOn) VALUES(S.DateKey,S.Date,S.FiscalYear,S.FiscalQuarter,S.Month,S.FullDate,S.MonthKey, current_timestamp(), src_file_name,  LastModifiedOn)"
6,dim_sales_order.csv,"Channel,SalesOrderLineKey,SalesOrder,SalesOrderLine,LastModifiedOn",true,ds_stg,dim_sales_order,ds_raw,dim_sales_order,ds_curated,dim_sales_order,,"MERGE ds_curated.dim_sales_order T USING (select * from (select *, row_number() over(partition by SalesOrderLineKey order by LastModifiedOn desc) as ROW_NUM   from ds_raw.dim_sales_order WHERE src_file_name ='{0}') t where t.ROW_NUM = 1) S ON T.SalesOrderLineKey = S.SalesOrderLineKey WHEN MATCHED THEN UPDATE SET T.SalesOrderLineKey=S.SalesOrderLineKey,T.Channel=S.Channel,T.SalesOrder=S.SalesOrder,T.SalesOrderLine=S.SalesOrderLine,T.Ingestion_Date=current_timestamp(),T.src_file_name=S.src_file_name, T.LastModifiedOn=S.LastModifiedOn WHEN NOT MATCHED THEN INSERT (Channel,SalesOrderLineKey,SalesOrder,SalesOrderLine,Ingestion_Date,src_file_name,LastModifiedOn) VALUES(S.Channel,S.SalesOrderLineKey,S.SalesOrder,S.SalesOrderLine,current_timestamp(),  src_file_name,  LastModifiedOn)"
1,fact_sales.csv,"SalesOrderLineKey,ResellerKey,CustomerKey,ProductKey,OrderDateKey,DueDateKey,ShipDateKey,SalesTerritoryKey,OrderQuantity,UnitPrice,ExtendedAmount,UnitPriceDiscountPct,ProductStandardCost,TotalProductCost,SalesAmount,LastModifiedOn",true,ds_stg,fact_sales,ds_raw,fact_sales,ds_curated,fact_sales,"col('SalesOrderLineKey'),col('ResellerKey'),col('CustomerKey'),col('ProductKey'),col('OrderDateKey'),col('DueDateKey'),col('ShipDateKey'),col('SalesTerritoryKey'),col('OrderQuantity'),col('UnitPrice'),col('ExtendedAmount'),col('UnitPriceDiscountPct'),col('ProductStandardCost'),col('TotalProductCost'),col('SalesAmount'),col('LastModifiedOn')","MERGE ds_curated.fact_sales T USING (select * from (select *, row_number() over(partition by SalesOrderLineKey order by LastModifiedOn desc) as ROW_NUM   from ds_raw.fact_sales WHERE src_file_name ='{0}') t where t.ROW_NUM = 1) S ON T.SalesOrderLineKey = S.SalesOrderLineKey WHEN MATCHED THEN UPDATE SET T.CustomerKey=S.CustomerKey, T.ProductKey=S.ProductKey,T.OrderDateKey=S.OrderDateKey,T.DueDateKey=S.DueDateKey,T.ShipDateKey=S.ShipDateKey,T.SalesTerritoryKey=S.SalesTerritoryKey,T.OrderQuantity=S.OrderQuantity,T.UnitPrice=S.UnitPrice,T.ExtendedAmount=S.ExtendedAmount,T.UnitPriceDiscountPct=S.UnitPriceDiscountPct,T.ProductStandardCost=S.ProductStandardCost,T.TotalProductCost=S.TotalProductCost,T.SalesAmount=S.SalesAmount,T.Ingestion_Date=current_timestamp(), T.src_file_name=S.src_file_name, T.LastModifiedOn=S.LastModifiedOn WHEN NOT MATCHED THEN INSERT (SalesOrderLineKey,  ResellerKey,  CustomerKey,  ProductKey,  OrderDateKey,  DueDateKey,  ShipDateKey,  SalesTerritoryKey,  OrderQuantity,  UnitPrice,  ExtendedAmount,  UnitPriceDiscountPct,  ProductStandardCost,  TotalProductCost,  SalesAmount,  Ingestion_Date,  src_file_name,  LastModifiedOn) VALUES(  S.SalesOrderLineKey,  S.ResellerKey,  S.CustomerKey,  S.ProductKey,  S.OrderDateKey,  S.DueDateKey,  S.ShipDateKey,  S.SalesTerritoryKey,  S.OrderQuantity,  S.UnitPrice,  S.ExtendedAmount,  S.UnitPriceDiscountPct,  S.ProductStandardCost,  S.TotalProductCost,  S.SalesAmount,  current_timestamp(),  src_file_name,  LastModifiedOn)"
3,dim_customer.csv,"CustomerKey,CustomerID,Customer,City,StateProvince,CountryRegion,PostalCode,LastModifiedOn",true,ds_stg,dim_customer,ds_raw,dim_customer,ds_curated,dim_customer,"col('CustomerKey'),col('CustomerID'),col('Customer'),col('City'),col('StateProvince'),col('CountryRegion'),col('PostalCode'),col('LastModifiedOn')","MERGE ds_curated.dim_customer T USING (select * from (select *, row_number() over(partition by CustomerKey order by LastModifiedOn desc) as ROW_NUM   from ds_raw.dim_customer WHERE src_file_name ='{0}') t where t.ROW_NUM = 1) S ON T.CustomerKey = S.CustomerKey WHEN MATCHED THEN UPDATE SET T.CustomerKey=S.CustomerKey,T.CustomerID=S.CustomerID,T.Customer=S.Customer,T.City=S.City,T.StateProvince=S.StateProvince,T.CountryRegion=S.CountryRegion,T.PostalCode=S.PostalCode,T.Ingestion_Date=current_timestamp(), T.src_file_name=S.src_file_name, T.LastModifiedOn=S.LastModifiedOn WHEN NOT MATCHED THEN INSERT (CustomerKey,CustomerID,Customer,City,StateProvince,CountryRegion,PostalCode,Ingestion_Date,src_file_name,LastModifiedOn) VALUES(S.CustomerKey,S.CustomerID,S.Customer,S.City,S.StateProvince,S.CountryRegion,S.PostalCode,current_timestamp(),  src_file_name,  LastModifiedOn)"
